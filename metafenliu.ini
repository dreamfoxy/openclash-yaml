# ==========================================================
# 方案 A · 最终修正版（加入 Google / Microsoft + 冷门节点）
# - 仅使用 GEOSITE / GEOIP（不再引用不存在的 yaml）
# - 保留 HK / TW / JP / SG / US 五个 url-test 体系不动
# - 应用组不提供“全节点手动 / 全节点自动”越权
# - 全节点手动 / 自动 只放在 Default / 漏网之鱼
# - 新增：冷门节点（排除 HK/JP/TW/US/SG），并让所有应用可选
# - Adobe 提供 REJECT（可禁止联网）
# ==========================================================

enable_rule_generator: true
overwrite_original_rules: true

# ==========================================================
# 节点清洗：剔除机场展示/说明/防失联/流量提示节点
# ==========================================================
exclude: 流量|套餐|到期|剩余|重置|官网|网站|最新网址|防失联|失联|官网地址|公告|通知|TG|Telegram|电报|群|频道|说明|使用说明|QQ群|客服|工单|订阅|Expire|Traffic|Reset|Remaining|Expire|Official|Website

# ==========================================================
# 1) 规则（自上而下优先级）
# ==========================================================

# ---CS2 ---
IP-CIDR,146.66.0.0/16,DIRECT,no-resolve
IP-CIDR,155.133.0.0/16,DIRECT,no-resolve
IP-CIDR,162.254.0.0/16,DIRECT,no-resolve
IP-CIDR,185.25.180.0/22,DIRECT,no-resolve
IP-CIDR,103.28.54.0/23,DIRECT,no-resolve   # 亚洲部分服务器
DOMAIN-SUFFIX,valve.net,DIRECT
DOMAIN-SUFFIX,steamcontent.com,DIRECT
DOMAIN-SUFFIX,steamserver.net,DIRECT

ruleset=Adobe,GEOSITE,adobe
ruleset=Adobe,GEOIP,adobe,no-resolve

# --- 私网直连 ---
ruleset=DIRECT,GEOSITE,private
ruleset=DIRECT,GEOIP,private,no-resolve

# --- Aethersailor 直连补丁 ---
ruleset=DIRECT,clash-domain:https://testingcf.jsdelivr.net/gh/Aethersailor/Custom_OpenClash_Rules@main/rule/Custom_Direct_Domain.yaml,28800
ruleset=DIRECT,clash-classic:https://testingcf.jsdelivr.net/gh/Aethersailor/Custom_OpenClash_Rules@main/rule/Custom_Direct_Classical_IP.yaml,28800

# --- Aethersailor 代理补丁（仅兜底用，不越权）---
ruleset=手动兜底,clash-domain:https://testingcf.jsdelivr.net/gh/Aethersailor/Custom_OpenClash_Rules@main/rule/Custom_Proxy_Domain.yaml,28800
ruleset=手动兜底,clash-classic:https://testingcf.jsdelivr.net/gh/Aethersailor/Custom_OpenClash_Rules@main/rule/Custom_Proxy_Classical_IP.yaml,28800

# --- 国内直连 ---
ruleset=DIRECT,GEOSITE,cn
ruleset=DIRECT,GEOIP,cn,no-resolve

# --- 国内可用 / 下载 / BT ---
ruleset=DIRECT,GEOSITE,google-cn
ruleset=DIRECT,GEOSITE,category-games@cn
ruleset=DIRECT,GEOSITE,category-game-platforms-download
ruleset=DIRECT,GEOSITE,category-public-tracker

# --- 核心应用 ---
ruleset=Notion,GEOSITE,Notion
ruleset=Notion,GEOIP,Notion,no-resolve

ruleset=Telegram,GEOSITE,telegram
ruleset=Telegram,GEOIP,telegram,no-resolve

ruleset=ChatGPT,GEOSITE,openai
ruleset=AI,GEOSITE,category-ai-!cn

ruleset=Apple,GEOSITE,apple
ruleset=YouTube,GEOSITE,youtube
ruleset=Netflix,GEOSITE,netflix
ruleset=Netflix,GEOIP,netflix,no-resolve

# --- 海外主流应用补充 ---
ruleset=TikTok,GEOSITE,tiktok
ruleset=TikTok,GEOIP,tiktok,no-resolve
ruleset=Instagram,GEOSITE,instagram
ruleset=X,GEOSITE,twitter

# --- 开发 / 工具 ---
ruleset=GitHub,GEOSITE,github
ruleset=GitHub,GEOIP,github,no-resolve
ruleset=测速工具,GEOSITE,category-speedtest
ruleset=Steam,GEOSITE,steam

# --- 交易所 & Adobe（全部走 GEOSITE）---
ruleset=OKX,GEOSITE,okx
ruleset=Binance,GEOSITE,binance
ruleset=Bybit,GEOSITE,bybit

# --- 社交 / 通讯 ---
ruleset=即时通讯,GEOSITE,category-communication
ruleset=社交媒体,GEOSITE,category-social-media-!cn

# --- Google / Microsoft/cf（新增） ---
ruleset=cloudflare,GEOSITE,cloudflare
ruleset=cloudflare,GEOIP,cloudflare,no-resolve

ruleset=Google,GEOSITE,google
ruleset=Google,GEOIP,google,no-resolve

ruleset=Microsoft,GEOSITE,microsoft
ruleset=Microsoft,GEOIP,microsoft,no-resolve

# --- GFW 兜底 ---
ruleset=手动兜底,GEOSITE,gfw

# --- 非标端口 ---
ruleset=非标端口,clash-classic:https://testingcf.jsdelivr.net/gh/Aethersailor/Custom_OpenClash_Rules@main/rule/Custom_Port_Direct.yaml,28800

# --- 最终兜底 ---
ruleset=漏网之鱼,FINAL

# ==========================================================
# 2) 应用分流策略组（UI 主入口，不越权）
# ==========================================================

custom_proxy_group=Notion`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]DIRECT`[]Default
custom_proxy_group=Apple`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]DIRECT`[]Default
custom_proxy_group=ChatGPT`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default
custom_proxy_group=AI`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default
custom_proxy_group=Telegram`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default
custom_proxy_group=即时通讯`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default
custom_proxy_group=社交媒体`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default

custom_proxy_group=YouTube`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default
custom_proxy_group=Netflix`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default

custom_proxy_group=TikTok`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default
custom_proxy_group=Instagram`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default
custom_proxy_group=X`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default

custom_proxy_group=GitHub`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default
custom_proxy_group=测速工具`select`[]DIRECT`[]手动选择`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default
custom_proxy_group=Steam`select`[]DIRECT`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default

custom_proxy_group=OKX`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]DIRECT`[]Default
custom_proxy_group=Binance`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]DIRECT`[]Default
custom_proxy_group=Bybit`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]DIRECT`[]Default

custom_proxy_group=Adobe`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]DIRECT`[]REJECT`[]Default
custom_proxy_group=Google`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default
custom_proxy_group=cloudflare`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default
custom_proxy_group=Microsoft`select`[]DIRECT`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]Default

# ==========================================================
# 3) Default / 漏网之鱼（唯一允许全节点）
# ==========================================================

custom_proxy_group=手动选择`select`[]自动选择`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]DIRECT
custom_proxy_group=Default`select`[]HK`[]TW`[]JP`[]SG`[]US`[]冷门节点`[]自动选择`[]手动选择`[]DIRECT
custom_proxy_group=漏网之鱼`select`[]Default`[]DIRECT`[]自动选择`[]冷门节点`[]手动选择

custom_proxy_group=非标端口`select`[]遵循规则`[]DIRECT
custom_proxy_group=遵循规则`select`[]漏网之鱼

# ==========================================================
# 4) 国家节点测速组
# ==========================================================

custom_proxy_group=手动选择`select`(?i).*
custom_proxy_group=自动选择`url-test`(?i).*`https://www.gstatic.com/generate_204`300,,50
custom_proxy_group=HK`url-test`(?i)(香港|\bHK\b|hongkong)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=TW`url-test`(?i)(台湾|\bTW\b|taiwan|taipei|hinet)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=JP`url-test`(?i)(日本|\bJP\b|tokyo|osaka)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=SG`url-test`(?i)(新加坡|\bSG\b|singapore)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=US`url-test`(?i)(美国|\bUS\b|united states|los angeles|san jose|seattle|new york)`http://www.gstatic.com/generate_204`300,,50

# 冷门节点：排除五大区（简化正则，避免解析问题）
custom_proxy_group=冷门节点`select`(?i)^(?!.*(香港|\bHK\b|hong\s*kong|日本|\bJP\b|tokyo|osaka|台湾|\bTW\b|taiwan|taipei|hinet|新加坡|\bSG\b|singapore|美国|\bUS\b|united\s*states|los\s*angeles|san\s*jose|seattle|new\s*york)).*
